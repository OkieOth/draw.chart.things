/* Fixed top-centered menu */
#menu {
    position: fixed;
    top: 8px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(255, 255, 255, 0.9);
    border: 1px solid #ccc;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    padding: 6px 10px;
    z-index: 1000;
    display: flex;
    gap: 8px;
    align-items: center;
}
/* Page layout: keep space under fixed menu */
body {
    margin: 0;
    font-family: sans-serif;
    background: #f7f7f9;
}
#canvas {
    /* push content below fixed menu */
    padding-top: 56px;
    height: calc(100vh - 56px);
    overflow: auto; /* allow scrolling when content grows */
    position: relative;
}
.svg-frame {
    width: 100%;
    height: 100%;
    border: none;
    display: block;
    background: white;
}
button {
    padding: 4px 8px;
    font-size: 14px;
}
/* Active toggle visual */
button.tool-btn.active {
    background: #0a84ff;
    color: #fff;
    border-color: #0a84ff;
}
/* Ensure SVG doesn't add extra clipping via CSS */
#canvas svg {
    overflow: visible;
}
/* Stage that we transform via CSS to avoid SVG clipping */
#svg-stage {
    position: relative; /* sized to content */
    transform-origin: 0 0;
    will-change: transform;
    /* Simple hardware acceleration - universally supported */
    transform: translate3d(0, 0, 0);
}
/* Cursor styles for pan */
#svg-stage.pan-enabled {
    cursor: grab;
}
#svg-stage.pan-dragging {
    cursor: grabbing;
}
/* Ensure the nested SVG doesn't clip internally */
#svg-stage svg {
    overflow: visible;
    display: block;
    /* Simple hardware acceleration for smooth transforms */
    transform: translate3d(0, 0, 0);
    /* Prevent subpixel rendering issues */
    backface-visibility: hidden;
}
/* Remove all problematic CSS properties - keep it simple */
#svg-stage svg * {
    /* Let browser use default SVG rendering */
}
/* Show pointer cursor for SVG elements with click handlers */
#svg-stage svg .svg-clickable {
    cursor: pointer;
}
/* Minimal text optimization */
#svg-stage svg text,
#svg-stage svg tspan {
    /* Only basic text improvements */
    text-rendering: optimizeLegibility;
}
/* Minimap overlay */
#minimap {
    position: fixed;
    right: 12px;
    bottom: 12px;
    width: 180px; /* minimap size */
    height: 120px;
    background: rgba(255, 255, 255, 0.9);
    border: 1px solid #ccc;
    border-radius: 6px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    padding: 6px;
    z-index: 999;
    display: none;
    align-items: center;
    justify-content: center;
}
#minimap svg {
    width: 100%;
    height: 100%;
    display: block;
}
#minimap .vp {
    fill: rgba(0, 128, 255, 0.2);
    stroke: #0a84ff;
    stroke-width: 1;
}
/* Right-side minimap stays on right; move collector to left to avoid overlap */
#collector {
    position: fixed;
    top: 56px; /* below menu */
    left: 12px;
    width: 240px;
    max-height: calc(50vh - 68px);
    overflow: auto;
    background: rgba(255, 255, 255, 0.95);
    border: 1px solid #ccc;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    padding: 10px;
    z-index: 998;
    display: flex;
    flex-direction: column;
}
#collector.hidden {
    display: none;
}
#collector .title {
    font-weight: 600;
    font-size: 14px;
    margin-bottom: 8px;
    color: #333;
}
#badge-list {
    display: flex;
    flex-direction: column; /* newest at top via explicit DOM prepend */
    gap: 6px;
}
.badge {
    display: inline-flex;
    align-items: center;
    justify-content: flex-start; /* align content from left */
    padding: 4px 8px;
    font-size: 12px;
    line-height: 1;
    border-radius: 999px;
    border: 1px solid rgba(0, 0, 0, 0.08);
    background: #eef6ff; /* default; can be adjusted later from shape props */
    color: #0a3d62;
    white-space: nowrap;
    gap: 6px;
    cursor: pointer; /* NEW: indicate clickable badges */
    max-width: 100%; /* NEW: ensure label can shrink and overflow is hidden for JS truncation */
}
.badge > span:first-child {
    flex: 1; /* label grows to take remaining space */
    overflow: hidden;
    white-space: nowrap;
    min-width: 0; /* allow flex child to shrink */
}

/* Blacklist collector styles (mirroring collector) */
#blacklist-collector {
    position: fixed;
    left: 12px;
    width: 240px;
    top: auto;
    /* Place directly below collector with minimal gap */
    margin-top: 6px;
    /* Use JS to dynamically set top based on collector's height if needed */
    background: rgba(255, 255, 255, 0.95);
    border: 1px solid #ccc;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    padding: 10px;
    z-index: 997;
    display: flex;
    flex-direction: column;
}
#blacklist-collector.hidden {
    display: none;
}
#blacklist-collector .title {
    font-weight: 600;
    font-size: 14px;
    margin-bottom: 8px;
    color: #333;
}
#blacklist-list {
    display: flex;
    flex-direction: column;
    gap: 6px;
}
.blacklist-badge {
    /* Strikethrough for blacklisted badge label */
    text-decoration: line-through;
    display: inline-flex;
    align-items: center;
    justify-content: flex-start;
    padding: 4px 8px;
    font-size: 12px;
    line-height: 1;
    border-radius: 999px;
    border: 1px solid rgba(0, 0, 0, 0.08);
    background: #eef6ff;
    color: #0a3d62;
    white-space: nowrap;
    gap: 6px;
    cursor: pointer;
    max-width: 100%;
}

/* Spinner overlay */
#spinner {
    position: fixed;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2000; /* above menu/minimap */
}
#spinner.hidden {
    display: none;
}
#spinner .spinner-backdrop {
    position: absolute;
    inset: 0;
    background: rgba(255, 255, 255, 0.6);
    backdrop-filter: blur(1px);
}
#spinner .spinner-content {
    position: relative;
    display: inline-flex;
    gap: 10px;
    align-items: center;
    background: #fff;
    border: 1px solid #ccc;
    border-radius: 10px;
    padding: 10px 14px;
    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.15);
    color: #333;
    font-weight: 600;
}
#spinner .spinner-content i {
    font-size: 20px;
    color: #0a84ff;
}

/* Highlight for hovered connection line: increase stroke width only */
line.highlight-group {
    stroke-width: 4 !important;
}

circle.highlight-group {
    stroke-width: 2 !important;
}

text.highlight-group {
    font-weight: 600;
}
