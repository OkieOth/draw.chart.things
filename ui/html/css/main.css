/* Fixed top-centered menu */
#menu {
    position: fixed;
    top: 8px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(255, 255, 255, 0.9);
    border: 1px solid #ccc;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    padding: 6px 10px;
    z-index: 1000;
    display: flex;
    gap: 8px;
    align-items: center;
}
/* Page layout: keep space under fixed menu */
body {
    margin: 0;
    font-family: sans-serif;
    background: #f7f7f9;
}
#canvas {
    /* push content below fixed menu */
    padding-top: 56px;
    height: calc(100vh - 56px);
    overflow: auto; /* allow scrolling when content grows */
    position: relative;
}
.svg-frame {
    width: 100%;
    height: 100%;
    border: none;
    display: block;
    background: white;
}
button {
    padding: 4px 8px;
    font-size: 14px;
}
/* Editable combobox styling */
.toolbar-combobox {
    position: relative;
    display: inline-flex;
    flex-direction: column;
    align-items: stretch;
    gap: 4px;
    min-width: 240px;
}
.toolbar-combo-field {
    display: flex;
    align-items: stretch;
    gap: 4px;
}
.toolbar-combo-input {
    border: 1px solid #ccc;
    border-radius: 6px;
    padding: 4px 10px;
    font-size: 13px;
    line-height: 20px;
    min-width: 0;
    background: #fff;
}
.toolbar-combo-input:focus {
    outline: none;
    border-color: #0a84ff;
    box-shadow: 0 0 0 2px rgba(10, 132, 255, 0.15);
}
.toolbar-combo-toggle {
    padding: 4px 6px;
}
.toolbar-combobox.open .toolbar-combo-toggle {
    background: #0a84ff;
    color: #fff;
}
.toolbar-combo-dropdown {
    position: absolute;
    top: calc(100% + 6px);
    left: 0;
    right: 0;
    background: rgba(255, 255, 255, 0.98);
    border: 1px solid #ccc;
    border-radius: 8px;
    box-shadow: 0 4px 18px rgba(0, 0, 0, 0.15);
    max-height: 320px;
    overflow-y: auto;
    z-index: 1100;
    padding: 4px 0;
}
.toolbar-combo-dropdown.hidden {
    display: none;
}
.toolbar-combo-option,
.toolbar-combo-empty {
    padding: 6px 12px;
    font-size: 13px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
}
.toolbar-combo-option:hover,
.toolbar-combo-option.active {
    background: rgba(10, 132, 255, 0.12);
}
.toolbar-combo-empty {
    cursor: default;
    color: #555;
    font-style: italic;
}
.toolbar-combo-option input[type="checkbox"] {
    pointer-events: none;
}
.toolbar-combo-option-label {
    flex: 1;
    min-width: 0;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
.toolbar-combo-option-upload {
    color: #0a3d62;
    font-weight: 600;
}
/* Active toggle visual */
button.tool-btn.active {
    background: #0a84ff;
    color: #fff;
    border-color: #0a84ff;
}
/* Ensure SVG doesn't add extra clipping via CSS */
#canvas svg {
    overflow: visible;
}
/* Stage that we transform via CSS to avoid SVG clipping */
#svg-stage {
    position: relative; /* sized to content */
    transform-origin: 0 0;
    will-change: transform;
    /* Simple hardware acceleration - universally supported */
    transform: translate3d(0, 0, 0);
}
/* Cursor styles for pan */
#svg-stage.pan-enabled {
    cursor: grab;
}
#svg-stage.pan-dragging {
    cursor: grabbing;
}
/* Ensure the nested SVG doesn't clip internally */
#svg-stage svg {
    overflow: visible;
    display: block;
    /* Simple hardware acceleration for smooth transforms */
    transform: translate3d(0, 0, 0);
    /* Prevent subpixel rendering issues */
    backface-visibility: hidden;
}
/* Remove all problematic CSS properties - keep it simple */
#svg-stage svg * {
    /* Let browser use default SVG rendering */
}
/* Show pointer cursor for SVG elements with click handlers */
#svg-stage svg .svg-clickable {
    cursor: pointer;
}
/* Minimal text optimization */
#svg-stage svg text,
#svg-stage svg tspan {
    /* Only basic text improvements */
    text-rendering: optimizeLegibility;
}
/* Minimap overlay */
#minimap {
    position: fixed;
    right: 12px;
    bottom: 12px;
    width: 180px; /* minimap size */
    height: 120px;
    background: rgba(255, 255, 255, 0.9);
    border: 1px solid #ccc;
    border-radius: 6px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    padding: 6px;
    z-index: 999;
    display: none;
    align-items: center;
    justify-content: center;
}
#minimap svg {
    width: 100%;
    height: 100%;
    display: block;
}
#minimap .vp {
    fill: rgba(0, 128, 255, 0.2);
    stroke: #0a84ff;
    stroke-width: 1;
}
/* Right-side minimap stays on right; move collector to left to avoid overlap */
#selected-collector,
#collector {
    position: fixed;
    top: 56px; /* below menu */
    left: 12px;
    width: 240px;
    max-height: calc(50vh - 68px);
    overflow: auto;
    background: rgba(255, 255, 255, 0.95);
    border: 1px solid #ccc;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    padding: 10px;
    z-index: 998;
    display: flex;
    flex-direction: column;
}
#selected-collector.hidden,
#collector.hidden {
    display: none;
}
#selected-collector .title,
#collector .title {
    font-weight: 600;
    font-size: 14px;
    margin-bottom: 8px;
    color: #333;
}
#selected-mixins-list,
#badge-list {
    display: flex;
    flex-direction: column; /* newest at top via explicit DOM prepend */
    gap: 6px;
}
.selected-mixin-badge {
    display: inline-flex;
    align-items: center;
    justify-content: flex-start;
    padding: 4px 8px;
    font-size: 12px;
    line-height: 1;
    border-radius: 999px;
    border: 1px solid rgba(0, 0, 0, 0.08);
    background: #eef6ff;
    color: #0a3d62;
    white-space: nowrap;
    gap: 6px;
}
.selected-mixin-label {
    flex: 1;
    min-width: 0;
    overflow: hidden;
    text-overflow: ellipsis;
}
.selected-mixin-remove {
    padding: 0 6px;
    line-height: 1;
    font-size: 11px;
    border: none;
    background: transparent;
    color: inherit;
}
.collector-empty {
    font-size: 12px;
    color: #666;
    font-style: italic;
}
.badge {
    display: inline-flex;
    align-items: center;
    justify-content: flex-start; /* align content from left */
    padding: 4px 8px;
    font-size: 12px;
    background: #eef6ff; /* default; can be adjusted later from shape props */
    color: #0a3d62;
    white-space: nowrap;
    gap: 6px;
    cursor: pointer; /* NEW: indicate clickable badges */
    max-width: 100%; /* NEW: ensure label can shrink and overflow is hidden for JS truncation */
}
.badge > span:first-child {
    flex: 1; /* label grows to take remaining space */
    overflow: hidden;
    white-space: nowrap;
    min-width: 0; /* allow flex child to shrink */
}

/* Blacklist collector styles (mirroring collector) */
#blacklist-collector {
    position: fixed;
    left: 12px;
    width: 240px;
    top: 56px;
    background: rgba(255, 255, 255, 0.95);
    border: 1px solid #ccc;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    padding: 10px;
    z-index: 997;
    display: flex;
    flex-direction: column;
}
#blacklist-collector.hidden {
    display: none;
}
#blacklist-collector .title {
    font-weight: 600;
    font-size: 14px;
    margin-bottom: 8px;
    color: #333;
}
#blacklist-list {
    display: flex;
    flex-direction: column;
    gap: 6px;
}
.blacklist-badge {
    /* Strikethrough for blacklisted badge label */
    text-decoration: line-through;
    display: inline-flex;
    align-items: center;
    justify-content: flex-start;
    padding: 4px 8px;
    font-size: 12px;
    line-height: 1;
    border-radius: 999px;
    border: 1px solid rgba(0, 0, 0, 0.08);
    background: #eef6ff;
    color: #0a3d62;
    white-space: nowrap;
    gap: 6px;
    cursor: pointer;
    max-width: 100%;
}

/* Spinner overlay */
#spinner {
    position: fixed;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2000; /* above menu/minimap */
}
#spinner.hidden {
    display: none;
}
#spinner .spinner-backdrop {
    position: absolute;
    inset: 0;
    background: rgba(255, 255, 255, 0.6);
    backdrop-filter: blur(1px);
}
#spinner .spinner-content {
    position: relative;
    display: inline-flex;
    gap: 10px;
    align-items: center;
    background: #fff;
    border: 1px solid #ccc;
    border-radius: 10px;
    padding: 10px 14px;
    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.15);
    color: #333;
    font-weight: 600;
}
#spinner .spinner-content i {
    font-size: 20px;
    color: #0a84ff;
}

/* Highlight for hovered connection line: increase stroke width only */
line.highlight-group {
    stroke-width: 4 !important;
}

circle.highlight-group {
    stroke-width: 2 !important;
}

text.highlight-group {
    font-weight: 600;
}

/* Dim non-highlighted connections/comments while a group is focused */
line.connection.connection-dimmed {
    stroke: #ddd !important;
    stroke-width: 2 !important;
}

circle.connection-comment-dimmed {
    stroke: #ddd !important;
    stroke-width: 1 !important;
    fill: #ddd !important;
    color: #ddd !important;
}
