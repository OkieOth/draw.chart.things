<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>SVG UI Prototype</title>
        <!-- Initialize default depth before any other scripts -->
        <script>
            window.defaultDepth = 2;
        </script>

        <script src="./js/htmx_1.9.12.min.js"></script>
        <script src="./js/wasm_exec.js"></script>
        <script src="./js/main.js"></script>
        <link
            rel="stylesheet"
            href="./css/font-awesome_6.5.1all.min.css"
            integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        />
        <link
            rel="stylesheet"
            href="./css/main.css"
        />
    </head>
    <body>
        <!-- Fixed menu (stays put during pan/zoom) -->
        <div id="menu">
            <strong>SVG Controls:</strong>
            <button title="Zoom +" hx-on:click="window.svgControls.zoom(1.2)">
                <i class="fa-solid fa-magnifying-glass-plus"></i>
            </button>
            <button title="Zoom -" hx-on:click="window.svgControls.zoom(1/1.2)">
                <i class="fa-solid fa-magnifying-glass-minus"></i>
            </button>
            <button
                title="Reset viewport"
                hx-on:click="window.svgControls.reset()"
            >
                <i class="fa-solid fa-rotate-left"></i>
            </button>
            <button
                title="Save current view"
                hx-on:click="window.svgControls.save()"
            >
                <i class="fa-solid fa-floppy-disk"></i>
            </button>
            <!-- Updated buttons with IDs and classes -->
            <button
                id="btn-minimap"
                class="tool-btn"
                hx-on:click="window.svgControls.toggleMinimap()"
                title="Toggle Minimap"
            >
                <i class="fa-solid fa-map"></i>
            </button>
            <button
                id="btn-collector"
                class="tool-btn"
                hx-on:click="window.svgControls.toggleCollector()"
                title="Toggle Expanded Box"
            >
                <i class="fa-solid fa-arrows-up-down"></i>
            </button>
            <!-- Blacklist tool toggle -->
            <button
                id="btn-blacklist"
                class="tool-btn"
                hx-on:click="window.svgControls.toggleBlacklist()"
                title="Blacklist Mode (Hide Objects)"
            >
                <i class="fa-solid fa-ban"></i>
            </button>
            <!-- Pan tool toggle -->
            <button
                id="btn-pan"
                class="tool-btn"
                hx-on:click="window.svgControls.togglePanTool()"
                title="Toggle Pan Tool"
            >
                <i class="fa-solid fa-arrows-up-down-left-right"></i>
            </button>
            <!-- Debug tool toggle -->
            <button
                id="btn-debug"
                class="tool-btn"
                hx-on:click="window.svgControls.toggleDebug()"
                title="Toggle Debug View"
            >
                <i class="fa-solid fa-bug"></i>
            </button>
        </div>

        <!-- Minimap -->
        <div id="minimap" aria-hidden="true" style="display: none">
            <svg
                id="minimap-svg"
                viewBox="0 0 100 100"
                preserveAspectRatio="xMidYMid meet"
            >
                <!-- Scene outline -->
                <rect
                    id="minimap-scene"
                    x="0"
                    y="0"
                    width="100"
                    height="100"
                    fill="none"
                    stroke="#bbb"
                />
                <!-- Preview of content -->
                <g id="minimap-content"></g>
                <!-- Viewport rectangle -->
                <rect
                    id="minimap-vp"
                    class="vp"
                    x="0"
                    y="0"
                    width="10"
                    height="10"
                />
            </svg>
        </div>

        <!-- Badge collector box (now left side) -->
        <div
            id="collector"
            class="hidden"
            aria-live="polite"
            aria-hidden="true"
        >
            <div class="title">Expanded Items</div>
            <div id="badge-list"></div>
        </div>

        <!-- Blacklist collector box (left side, below expanded) -->
        <div
            id="blacklist-collector"
            class="hidden"
            aria-live="polite"
            aria-hidden="true"
        >
            <div class="title">Blacklisted Items</div>
            <div id="blacklist-list"></div>
        </div>

        <div id="canvas">
            <!-- ...existing code... -->
            <!-- SVG will be loaded here via boxes.wasm -->
            <!-- ...existing code... -->
        </div>

        <script>
            window.initPage();
            window.handleInputQueryParam();
            window.loadYamlInput();
            window.loadSVGFromWasm();
        </script>
    </body>
</html>
