{
  "$schema": "http://json-schema.org/draft-04/schema#",
  "title": "Boxes",
  "description": "Model to describe the input of block diagrams",
  "x-domain": "input",
  "type": "object",
  "properties": {
    "title": {
      "description": "Title of the document",
      "type": "string"
    },
    "titleFormat": {
      "description": "format reference used for the title",
      "type": "string"
    },
    "version": {
      "description": "allows to include a version for the layout description",
      "type": "string"
    },
    "legend": {
      "description": "Legend definition used in this diagram",
      "$ref": "#/definitions/Legend"
    },
    "boxes": {
      "$ref": "#/definitions/Layout"
    },
    "formats": {
      "$comment": "if the map contains an key 'default' it will be used as default format",
      "description": "Map of formats available to be used in the boxes",
      "type": "object",
      "additionalProperties": {
        "$ref": "#/definitions/Format"
      }
    },
    "formatVariations": {
      "description": "Set of formats that overwrites the style of boxes, if specific conditions are met",
      "$ref": "#/definitions/FormatVariations"
    },
    "images": {
      "description": "optional map of images used in the generated graphic",
      "type": "object",
      "additionalProperties": {
        "$ref": "./formats.json#/definitions/ImageDef"
      }
    },
    "hideTextsForParents": {
      "type": "boolean",
      "description": "If that is set, then the additional texts are only visible when the box has no visible children",
      "default": false
    },
    "lineDist": {
      "type": "integer",
      "description": "minimal distance between overlapping lines",
      "default": 4
    },
    "globalPadding": {
      "type": "integer",
      "description": "Padding used as default over the whole diagram",
      "default": 5
    },
    "minBoxMargin": {
      "type": "integer",
      "description": "Minimum margin between boxes",
      "default": 10
    },
    "minConnectorMargin": {
      "type": "integer",
      "description": "Minimum margin between connectors",
      "default": 10
    }
  },
  "required": ["title", "boxes", "hideTextsForParents"],
  "definitions": {
    "Legend": {
      "description": "Definition of the output for the legend",
      "type": "object",
      "properties": {
        "entries": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/LegendEntry"
          }
        },
        "format": {
          "description": "format reference used for the legend texts",
          "type": "string"
        }
      }
    },
    "LegendEntry": {
      "description": "Definition of one legend entry",
      "type": "object",
      "properties": {
        "text": {
          "type": "string"
        },
        "format": {
          "description": "this format reference used to identify how the here described object is in the picture displayed.",
          "type": "string"
        }
      },
      "required": ["text", "format"]
    },
    "Layout": {
      "type": "object",
      "properties": {
        "id": {
          "description": "unique identifier of that entry",
          "type": "string"
        },
        "caption": {
          "description": "Some kind of the main text",
          "type": "string"
        },
        "text1": {
          "description": "First additional text",
          "type": "string"
        },
        "text2": {
          "description": "Second additional text",
          "type": "string"
        },
        "comment": {
          "description": "additional comment, that can be then included in the created graphic",
          "$ref": "./shared.json#/definitions/Comment"
        },
        "image": {
          "description": "Reference to an image that should be displayed, needs to be declared in the global image section",
          "type": "string"
        },
        "expand": {
          "description": "in case the picture is rendered with given expanded IDs, and maxDepth, then if this flag is true, the box is still displayed expanded",
          "type": "boolean"
        },
        "extVertical": {
          "description": "If set, then the content for 'vertical' attrib is loaded from an external file",
          "$comment": "relative paths are possible",
          "type": "string"
        },
        "vertical": {
          "$ref": "#/definitions/LayoutArray"
        },
        "extHorizontal": {
          "description": "If set, then the content for 'horizontal' attrib is loaded from an external file",
          "$comment": "relative paths are possible",
          "type": "string"
        },
        "horizontal": {
          "$ref": "#/definitions/LayoutArray"
        },
        "tags": {
          "description": "Tags to annotate the box, tags are used to format and filter",
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "connections": {
          "description": "List of connections to other boxes",
          "type": "array",
          "items": {
            "$ref": "#/definitions/Connection"
          }
        },
        "format": {
          "description": "reference to the format to use for this box",
          "type": "string"
        },
        "dontBlockConPaths": {
          "description": "if that is set then connections can run through the box, as long as they don't cross the text",
          "type": "boolean"
        },
        "dataLink": {
          "description": "Optional link to a source, related to this element. This can be used for instance for on-click handlers in a UI or simply as documentation.",
          "type": "string"
        }
      },
      "required": ["type", "id", "caption", "text1", "text2", "expand"]
    },
    "LayoutArray": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/Layout"
      }
    },
    "LayoutMixin": {
      "description": "container to extend the layouts of a given layout element via mixins",
      "type": "object",
      "properties": {
        "horizontal": {
          "$ref": "#/definitions/LayoutArray"
        },
        "vertical": {
          "$ref": "#/definitions/LayoutArray"
        }
      }
    },
    "Connection": {
      "type": "object",
      "properties": {
        "dest": {
          "description": "Caption text of the destination box, can be used as alternative to 'destId'",
          "type": "string"
        },
        "destId": {
          "description": "box id of the destination",
          "type": "string"
        },
        "comment": {
          "description": "additional comment, that can be then included in the created graphic",
          "$ref": "./shared.json#/definitions/Comment"
        },
        "sourceArrow": {
          "description": "Arrow at the source box",
          "type": "boolean"
        },
        "destArrow": {
          "description": "Arrow at the destination box",
          "type": "boolean"
        },
        "format": {
          "description": "optional format to style the connection",
          "type": "string"
        },
        "tags": {
          "description": "Tags to annotate the connection, tags are used to format",
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      },
      "required": ["dest", "destId", "sourceArrow", "destArrow", "tags"]
    },
    "Format": {
      "type": "object",
      "properties": {
        "widthOfParent": {
          "description": "sets the width of the object to the width of the parent",
          "type": "boolean"
        },
        "fixedWidth": {
          "type": "integer",
          "description": "optional fixed width that will be applied on the box"
        },
        "fixedHeight": {
          "type": "integer",
          "description": "optional fixed height that will be applied on the box"
        },
        "verticalTxt": {
          "type": "boolean",
          "description": "If true, the text will be displayed vertically",
          "default": false
        },
        "fontCaption": {
          "$ref": "./formats.json#/definitions/FontDef"
        },
        "fontText1": {
          "$ref": "./formats.json#/definitions/FontDef"
        },
        "fontText2": {
          "$ref": "./formats.json#/definitions/FontDef"
        },
        "fontComment": {
          "$ref": "./formats.json#/definitions/FontDef"
        },
        "fontCommentMarker": {
          "$ref": "./formats.json#/definitions/FontDef"
        },
        "line": {
          "$ref": "./formats.json#/definitions/LineDef"
        },
        "fill": {
          "$ref": "./formats.json#/definitions/FillDef"
        },
        "padding": {
          "type": "integer",
          "description": "Padding used for this format",
          "default": 5
        },
        "boxMargin": {
          "type": "integer",
          "description": "Minimum margin between boxes",
          "default": 10
        },
        "cornerRadius": {
          "description": "radius of the box corners in pixel",
          "type": "integer"
        }
      }
    },
    "FormatVariations": {
      "type": "object",
      "properties": {
        "hasTag": {
          "description": "dictionary with tag values as key, that contains format definitions.",
          "$comment": "when an object contains a specific tag, then it originally format, will be overwritten with the here defined values",
          "type": "object",
          "additionalProperties": {
            "$ref": "#/definitions/Format"
          }
        }
      }
    }
  }
}
