{
  "$schema": "http://json-schema.org/draft-04/schema#",
  "title": "BoxesDocument",
  "description": "Internal model to describe the layout if the boxes chart",
  "type": "object",
  "x-domain": "implementation",
  "properties": {
    "title": {
      "description": "Title of the document",
      "type": "string"
    },
    "titleFormat": {
      "description": "format reference used for the title",
      "type": "string"
    },
    "legend": {
      "description": "Legend definition used in this diagram",
      "$ref": "./boxes.json#/definitions/Legend"
    },
    "boxes": {
      "$ref": "#/definitions/LayoutElement"
    },
    "height": {
      "type": "integer",
      "description": "Height of the document"
    },
    "width": {
      "type": "integer",
      "description": "Width of the document"
    },
    "connections": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/ConnectionElem"
      }
    },
    "connectedElems": {
      "type": "array",
      "items": {
        "type": "string"
      }
    },
    "lineDist": {
      "type": "integer",
      "description": "minimal distance between overlapping lines",
      "default": 4
    },
    "globalPadding": {
      "type": "integer",
      "description": "Padding used as default over the whole diagram",
      "default": 5
    },
    "minBoxMargin": {
      "type": "integer",
      "description": "Minimum margin between boxes",
      "default": 10
    },
    "minConnectorMargin": {
      "type": "integer",
      "description": "Minimum margin between connectors",
      "default": 10
    },
    "formats": {
      "$comment": "if the map contains an key 'default' it will be used as default format",
      "description": "Map of formats available to be used in the boxes",
      "type": "object",
      "additionalProperties": {
        "$ref": "#/definitions/BoxFormat"
      }
    },
    "images": {
      "description": "Map of images used in the generated graphic",
      "type": "object",
      "additionalProperties": {
        "$ref": "./formats.json#/definitions/ImageDef"
      }
    },
    "verticalRoads": {
      "description": "Vertical roads available to connect boxes in a vertical way",
      "type": "array",
      "items": {
        "$ref": "#/definitions/ConnectionLine"
      }
    },
    "horizontalRoads": {
      "description": "Horizontal roads available to connect boxes in a horizontal way",
      "type": "array",
      "items": {
        "$ref": "#/definitions/ConnectionLine"
      }
    },
    "connectionNodes": {
      "description": "helper structure to take the node points for the possible connection graph",
      "type": "array",
      "items": {
        "$ref": "#/definitions/ConnectionNode"
      }
    },
    "horizontalLines": {
      "description": "helper structure for resolving the collisions",
      "type": "array",
      "items": {
        "$ref": "#/definitions/ConnectionLine"
      }
    },
    "verticalLines": {
      "description": "helper structure for resolving the collisions",
      "type": "array",
      "items": {
        "$ref": "#/definitions/ConnectionLine"
      }
    },
    "comments": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/CommentContainer"
      }
    },
    "overlays": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/DocOverlay"
      }
    },
    "hasHiddenComments": {
      "description": "is set to true, if there are some comments truncated from the original layout",
      "type": "boolean"
    },
    "commentMarkerRadius": {
      "description": "hold the radius of the comment markers to use",
      "type": "integer"
    },
    "legendEndY": {
      "description": "hold the radius of the comment markers to use",
      "type": "integer"
    },
    "commentCurrent": {
      "description": "helper to align tne number of unspecified markers",
      "type": "integer"
    }
  },
  "required": [
    "title",
    "boxes",
    "height",
    "width",
    "minBoxMargin",
    "minConnectorMargin",
    "globalPadding",
    "lineDist",
    "commentMarkerRadius",
    "commentCurrent",
    "legendEndY",
    "hasHiddenComments"
  ],
  "definitions": {
    "LayoutElement": {
      "type": "object",
      "properties": {
        "id": {
          "description": "unique identifier of that entry",
          "type": "string"
        },
        "caption": {
          "description": "Some kind of the main text",
          "type": "string"
        },
        "text1": {
          "description": "First additional text",
          "type": "string"
        },
        "text2": {
          "description": "Second additional text",
          "type": "string"
        },
        "comments": {
          "description": "additional comments, that can be then included in the created graphic",
          "type": "array",
          "items": {
            "$ref": "./shared.json#/definitions/Comment"
          }
        },
        "hiddenComments": {
          "description": "true if in the proccessing some comments where truncated with removed child elemens",
          "type": "boolean"
        },
        "image": {
          "discription": "image to be displayed",
          "$ref": "#/definitions/ImageContainer"
        },
        "vertical": {
          "$ref": "#/definitions/LayoutElemContainer"
        },
        "horizontal": {
          "$ref": "#/definitions/LayoutElemContainer"
        },
        "x": {
          "type": "integer",
          "description": "X position of the element"
        },
        "y": {
          "type": "integer",
          "description": "Y position of the element"
        },
        "width": {
          "type": "integer",
          "description": "Width of the element"
        },
        "height": {
          "type": "integer",
          "description": "Height of the element"
        },
        "centerX": {
          "type": "integer",
          "description": "X position of the center of the element"
        },
        "centerY": {
          "type": "integer",
          "description": "X position of the center of the element"
        },
        "format": {
          "$ref": "#/definitions/BoxFormat"
        },
        "connections": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/LayoutElemConnection"
          }
        },
        "leftYToStart": {
          "type": "integer",
          "description": "Y position of the left side of the element to start the connection"
        },
        "rightYToStart": {
          "type": "integer",
          "description": "Y position of the right side of the element to start the connection"
        },
        "topXToStart": {
          "type": "integer",
          "description": "X position of the top side of the element to start the connection"
        },
        "bottomXToStart": {
          "type": "integer",
          "description": "X position of the bottom side of the element to start the connection"
        },
        "xTextBox": {
          "type": "integer",
          "description": "X position where the text would start"
        },
        "yTextBox": {
          "type": "integer",
          "description": "Y position where the text would start"
        },
        "widthTextBox": {
          "type": "integer",
          "description": "Width of the text area"
        },
        "heightTextBox": {
          "type": "integer",
          "description": "Height of the text area"
        },
        "dontBlockConPaths": {
          "description": "if that is set then connections can run through the box, as long as they don't cross the text",
          "type": "boolean"
        },
        "tags": {
          "description": "Tags to annotate the box, tags are used to format and filter",
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "dataLink": {
          "description": "Optional link to a source, related to this element. This can be used for instance for on-click handlers in a UI or simply as documentation.",
          "type": "string"
        }
      },
      "required": [
        "id",
        "x",
        "y",
        "centerX",
        "centerY",
        "width",
        "height",
        "caption",
        "text1",
        "text2",
        "hiddenComments"
      ]
    },
    "LayoutElemContainer": {
      "type": "object",
      "properties": {
        "x": {
          "type": "integer",
          "description": "X position of the element"
        },
        "y": {
          "type": "integer",
          "description": "Y position of the element"
        },
        "width": {
          "type": "integer",
          "description": "Width of the container"
        },
        "height": {
          "type": "integer",
          "description": "Height of the container"
        },
        "elems": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/LayoutElement"
          }
        }
      },
      "required": ["x", "y", "width", "height", "elems"]
    },
    "LayoutElemConnection": {
      "type": "object",
      "properties": {
        "destId": {
          "description": "box id of the destination",
          "type": "string"
        },
        "comment": {
          "description": "additional comment, that can be then included in the created graphic",
          "$ref": "./shared.json#/definitions/Comment"
        },
        "sourceArrow": {
          "description": "Arrow at the source box",
          "type": "boolean"
        },
        "destArrow": {
          "description": "Arrow at the destination box",
          "type": "boolean"
        },
        "format": {
          "$ref": "./formats.json#/definitions/LineDef"
        },
        "hiddenComments": {
          "description": "is only set by while the layout is processed, don't set it in the definition",
          "type": "boolean"
        },
        "tags": {
          "description": "Tags to annotate the connection, tags are used to format",
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "destId",
        "sourceArrow",
        "destArrow",
        "tags",
        "hiddenComments"
      ]
    },
    "ConnectionElem": {
      "type": "object",
      "properties": {
        "from": {
          "type": "string",
          "description": "ID of the box where the connector starts"
        },
        "to": {
          "type": "string",
          "description": "ID of the box where the connector ends"
        },
        "sourceArrow": {
          "description": "Arrow at the source box",
          "type": "boolean"
        },
        "destArrow": {
          "description": "Arrow at the destination box",
          "type": "boolean"
        },
        "format": {
          "$ref": "./formats.json#/definitions/LineDef"
        },
        "hiddenComments": {
          "description": "is only set by while the layout is processed, don't set it in the definition",
          "type": "boolean"
        },
        "parts": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/ConnectionLine"
          }
        },
        "connectionIndex": {
          "description": "index of this connection, in the boxes_document object",
          "type": "integer"
        },
        "comment": {
          "$ref": "./shared.json#/definitions/Comment"
        }
      },
      "required": ["parts", "connectionIndex", "hiddenComments"]
    },
    "ConnectionLine": {
      "type": "object",
      "properties": {
        "startX": {
          "type": "integer"
        },
        "startY": {
          "type": "integer"
        },
        "endX": {
          "type": "integer"
        },
        "endY": {
          "type": "integer"
        },
        "srcLayoutId": {
          "description": "in case the line is connected to the start layout element, then here is its id",
          "type": "string"
        },
        "destLayoutId": {
          "description": "in case the line is connected to a end layout element, then here is its id",
          "type": "string"
        },
        "connectionIndex": {
          "description": "index of the connection, in the boxes_document object, where this line belongs too",
          "type": "integer"
        },
        "lineIndex": {
          "description": "position of the line in the connections part array",
          "type": "integer"
        },
        "format": {
          "$ref": "./formats.json#/definitions/LineDef"
        },
        "isStart": {
          "type": "boolean"
        },
        "isEnd": {
          "type": "boolean"
        }
      },
      "required": [
        "startX",
        "startY",
        "endX",
        "endY",
        "connectionIndex",
        "lineIndex",
        "isStart",
        "isEnd"
      ]
    },
    "ImageContainer": {
      "type": "object",
      "properties": {
        "x": {
          "type": "integer",
          "description": "X position of the element"
        },
        "y": {
          "type": "integer",
          "description": "Y position of the element"
        },
        "width": {
          "type": "integer",
          "description": "Width of the container"
        },
        "height": {
          "type": "integer",
          "description": "Height of the container"
        },
        "marginTopBottom": {
          "description": "distance top and bottom of the image",
          "type": "integer",
          "default": 5
        },
        "marginLeftRight": {
          "description": "distance left and right of the image",
          "type": "integer",
          "default": 2
        },
        "imgId": {
          "type": "string",
          "description": "reference to the globally declared image"
        }
      },
      "required": [
        "x",
        "y",
        "width",
        "height",
        "elems",
        "marginTopBottom",
        "marginLeftRight",
        "imgId"
      ]
    },
    "BoxFormat": {
      "type": "object",
      "properties": {
        "padding": {
          "type": "integer",
          "description": "Padding of the box"
        },
        "fontCaption": {
          "$ref": "./formats.json#/definitions/FontDef"
        },
        "fontText1": {
          "$ref": "./formats.json#/definitions/FontDef"
        },
        "fontText2": {
          "$ref": "./formats.json#/definitions/FontDef"
        },
        "fontComment": {
          "$ref": "./formats.json#/definitions/FontDef"
        },
        "fontCommentMarker": {
          "$ref": "./formats.json#/definitions/FontDef"
        },
        "line": {
          "$ref": "./formats.json#/definitions/LineDef"
        },
        "cornerRadius": {
          "description": "radius of the box corners in pixel",
          "type": "integer"
        },
        "fill": {
          "$ref": "./formats.json#/definitions/FillDef"
        },
        "minBoxMargin": {
          "type": "integer",
          "description": "Minimum margin between boxes"
        },
        "widthOfParent": {
          "description": "sets the width of the object to the width of the parent",
          "type": "boolean"
        },
        "fixedWidth": {
          "type": "integer",
          "description": "optional fixed width that will be applied on the box"
        },
        "fixedHeight": {
          "type": "integer",
          "description": "optional fixed height that will be applied on the box"
        },
        "verticalTxt": {
          "type": "boolean",
          "description": "If true, the text will be displayed vertically",
          "default": false
        }
      },
      "required": [
        "padding",
        "lineHeight",
        "fontCaption",
        "fontText1",
        "fontText2",
        "fontComment",
        "fontCommentMarker",
        "minBoxMargin",
        "verticalTxt"
      ]
    },
    "CommentFormat": {
      "type": "object",
      "properties": {
        "fontText": {
          "$ref": "./formats.json#/definitions/FontDef"
        },
        "fontMarker": {
          "$ref": "./formats.json#/definitions/FontDef"
        },
        "line": {
          "$ref": "./formats.json#/definitions/LineDef"
        },
        "fill": {
          "$ref": "./formats.json#/definitions/FillDef"
        }
      },
      "required": ["fontText", "fontMarker", "line", "fill"]
    },
    "ConnectionNode": {
      "description": "helper type for calculating the connections between elements",
      "type": "object",
      "properties": {
        "x": {
          "type": "integer",
          "description": "X position of the element"
        },
        "y": {
          "type": "integer",
          "description": "Y position of the element"
        },
        "nodeId": {
          "description": "in case the edge ends in a layout element, it takes the ID",
          "type": "string"
        },
        "boxId": {
          "description": "optional box id, only on connection nodes that are the entry points to real box connections",
          "type": "string"
        },
        "edges": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/ConnectionEdge"
          }
        }
      },
      "required": ["x", "y"]
    },
    "ConnectionEdge": {
      "description": "edge type to store edges on a connection node",
      "type": "object",
      "properties": {
        "x": {
          "type": "integer",
          "description": "X position of the element"
        },
        "y": {
          "type": "integer",
          "description": "Y position of the element"
        },
        "destNodeId": {
          "description": "either the box ID where the edge ends or the ID connection node",
          "type": "string"
        },
        "weight": {
          "description": "weight of the connection, based on the distance",
          "type": "integer"
        }
      },
      "required": ["x", "y", "weight"]
    },
    "CommentContainer": {
      "type": "object",
      "description": "all parameters to render the comments in the graphic",
      "properties": {
        "text": {
          "description": "text of the comment",
          "type": "string"
        },
        "label": {
          "description": "displayed in the marker for that note",
          "type": "string"
        },
        "format": {
          "description": "format name to use to render this note",
          "$ref": "#/definitions/CommentFormat"
        },
        "markerX": {
          "description": "x-coordinate of the marker for that comment",
          "type": "integer"
        },
        "markerY": {
          "description": "x-coordinate of the marker for that comment",
          "type": "integer"
        },
        "markerTextWidth": {
          "description": "calculated width of the marker text",
          "type": "integer"
        },
        "markerTextHeight": {
          "description": "calculated height of the marker text",
          "type": "integer"
        },
        "textWidth": {
          "description": "calculated width of the comment text",
          "type": "integer"
        },
        "textHeight": {
          "description": "calculated height of the comment text",
          "type": "integer"
        },
        "customMarker": {
          "description": "true if a custom marker is used for this comment",
          "type": "boolean"
        },
        "connectionIndex": {
          "description": "in case this comment belongs to a connection, is here the connectionId stored",
          "type": "integer"
        }
      },
      "required": [
        "text",
        "markerX",
        "markerY",
        "label",
        "markerTextWidth",
        "markerTextHeight",
        "textWidth",
        "textHeight",
        "format",
        "customMarker"
      ]
    },
    "DocOverlay": {
      "description": "Definition of a topic related overlay ... for instance for heatmaps",
      "type": "object",
      "properties": {
        "caption": {
          "description": "some catchy words to describe the displayed topc",
          "type": "string"
        },
        "refValue": {
          "description": "Optional reference value that defines the reference value for this type of overlay",
          "type": "number"
        },
        "centerXOffset": {
          "description": "in case of multiple overlays existing, this allows to define a percentage offset from the center-x of the related layout object",
          "type": "number"
        },
        "centerYOffset": {
          "description": "in case of multiple overlays existing, this allows to define a percentage offset from the center-y of the related layout object",
          "type": "number"
        },
        "layouts": {
          "description": "dictionary of layout elements, that contain this overlay. The dictionary stores the value for this specific object",
          "type": "object",
          "$comment": "keys of the dictionary are either IDs or captions of layout elements",
          "additionalProperties": {
            "$ref": "#/definitions/OverlayEntry"
          }
        },
        "radiusDefs": {
          "description": "if this is configured the the radius for the layouts is in a percentage of the refValue",
          "$ref": "./boxes.json#/definitions/OverlayRadiusDef"
        },
        "formats": {
          "$ref": "./boxes.json#/definitions/OverlayFormatDef"
        }
      },
      "required": [
        "caption",
        "refValue",
        "layouts",
        "centerXOffset",
        "centerYOffset"
      ]
    },
    "OverlayEntry": {
      "type": "object",
      "properties": {
        "value": {
          "type": "number"
        },
        "radius": {
          "type": "number"
        },
        "x": {
          "type": "integer"
        },
        "y": {
          "type": "integer"
        },
        "format": {
          "$ref": "#/definitions/BoxFormat"
        }
      },
      "required": ["value", "x", "y", "format", "radius"]
    }
  }
}
